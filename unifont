#!/usr/bin/env perl

# unifont - convert latin and greek to alternate font vvariation
# Tom Christiansen <tchrist@perl.com>
#
# version 0.0.1 - preliminary prototype
# Thu Jun  2 10:03:24 CDT 2011

use v5.12;
use utf8;
use strict;
use autodie;
use warnings;
use warnings qw< FATAL utf8 >;
use open qw< :std :encoding(UTF-8) >;
use charnames qw< :full >;

use File::Basename;
use Unicode::Normalize;

END { close STDOUT }

main();
exit();

sub main { 
    init();

    if (@ARGV) {
        refont("@ARGV");
        exit;
    } 

    if (-t STDIN) {
        warn "$0: reading from standard input, type ^D to end.\n";
    } 

    while (<>) {
        chomp;
        refont($_);
    } 

}

sub refont {

    my $orig = shift() // die;

    state $fontpairs = [
       ["DOUBLE-STRUCK"           => " ð”¸ ð”¹ â„‚ ð”» ð”¼ ð”½ ð”¾ â„ ð•€ ð• ð•‚ ð•ƒ ð•„ â„• ð•† â„™ â„š â„ ð•Š ð•‹ ð•Œ ð• ð•Ž ð• ð• â„¤ ð•’ ð•“ ð•” ð•• ð•– ð•— ð•˜ ð•™ ð•š ð•› ð•œ ð• ð•ž ð•Ÿ ð•  ð•¡ ð•¢ ð•£ ð•¤ ð•¥ ð•¦ ð•§ ð•¨ ð•© ð•ª ð•« ðŸ˜ ðŸ™ ðŸš ðŸ› ðŸœ ðŸ ðŸž ðŸŸ ðŸ  ðŸ¡ â„¾ â„½ â„¿ â„¼ â…€ " ],
       ["MONOSPACE"               => " ð™° ð™± ð™² ð™³ ð™´ ð™µ ð™¶ ð™· ð™¸ ð™¹ ð™º ð™» ð™¼ ð™½ ð™¾ ð™¿ ðš€ ðš ðš‚ ðšƒ ðš„ ðš… ðš† ðš‡ ðšˆ ðš‰ ðšŠ ðš‹ ðšŒ ðš ðšŽ ðš ðš ðš‘ ðš’ ðš“ ðš” ðš• ðš– ðš— ðš˜ ðš™ ðšš ðš› ðšœ ðš ðšž ðšŸ ðš  ðš¡ ðš¢ ðš£ ðŸ¶ ðŸ· ðŸ¸ ðŸ¹ ðŸº ðŸ» ðŸ¼ ðŸ½ ðŸ¾ ðŸ¿ " ],

       ["SANS-SERIF"              => " ð–  ð–¡ ð–¢ ð–£ ð–¤ ð–¥ ð–¦ ð–§ ð–¨ ð–© ð–ª ð–« ð–¬ ð–­ ð–® ð–¯ ð–° ð–± ð–² ð–³ ð–´ ð–µ ð–¶ ð–· ð–¸ ð–¹ ð–º ð–» ð–¼ ð–½ ð–¾ ð–¿ ð—€ ð— ð—‚ ð—ƒ ð—„ ð—… ð—† ð—‡ ð—ˆ ð—‰ ð—Š ð—‹ ð—Œ ð— ð—Ž ð— ð— ð—‘ ð—’ ð—“ ðŸ¢ ðŸ£ ðŸ¤ ðŸ¥ ðŸ¦ ðŸ§ ðŸ¨ ðŸ© ðŸª ðŸ« " ],
       ["SANS-SERIF ITALIC"       => " ð˜ˆ ð˜‰ ð˜Š ð˜‹ ð˜Œ ð˜ ð˜Ž ð˜ ð˜ ð˜‘ ð˜’ ð˜“ ð˜” ð˜• ð˜– ð˜— ð˜˜ ð˜™ ð˜š ð˜› ð˜œ ð˜ ð˜ž ð˜Ÿ ð˜  ð˜¡ ð˜¢ ð˜£ ð˜¤ ð˜¥ ð˜¦ ð˜§ ð˜¨ ð˜© ð˜ª ð˜« ð˜¬ ð˜­ ð˜® ð˜¯ ð˜° ð˜± ð˜² ð˜³ ð˜´ ð˜µ ð˜¶ ð˜· ð˜¸ ð˜¹ ð˜º ð˜» " ],
       ["SANS-SERIF BOLD"         => " ð—” ð—• ð—– ð—— ð—˜ ð—™ ð—š ð—› ð—œ ð— ð—ž ð—Ÿ ð—  ð—¡ ð—¢ ð—£ ð—¤ ð—¥ ð—¦ ð—§ ð—¨ ð—© ð—ª ð—« ð—¬ ð—­ ð—® ð—¯ ð—° ð—± ð—² ð—³ ð—´ ð—µ ð—¶ ð—· ð—¸ ð—¹ ð—º ð—» ð—¼ ð—½ ð—¾ ð—¿ ð˜€ ð˜ ð˜‚ ð˜ƒ ð˜„ ð˜… ð˜† ð˜‡ ðŸ¬ ðŸ­ ðŸ® ðŸ¯ ðŸ° ðŸ± ðŸ² ðŸ³ ðŸ´ ðŸµ "    .
                                     " ð– ð— ð˜ ð™ ðš ð› ðœ ð ðž ðŸ ð  ð¡ ð¢ ð£ ð¤ ð¥ ð¦ ð§ ð¨ ð© ðª ð« ð¬ ð­ ð® ð¯ ð° ð± ð² ð³ ð´ ðµ ð¶ ð· ð¸ ð¹ ðº ð» ð¼ ð½ ð¾ ð¿ ðž€ ðž ðž‚ ðžƒ ðž„ ðž… ðž† ðž‡ ðžˆ ðž‰ ðžŠ ðž‹ ðžŒ ðž ðžŽ ðž ðŸ¬ ðŸ­ ðŸ® ðŸ¯ ðŸ° ðŸ± ðŸ² ðŸ³ ðŸ´ ðŸµ " ],
       ["SANS-SERIF BOLD ITALIC"  => " ð˜¼ ð˜½ ð˜¾ ð˜¿ ð™€ ð™ ð™‚ ð™ƒ ð™„ ð™… ð™† ð™‡ ð™ˆ ð™‰ ð™Š ð™‹ ð™Œ ð™ ð™Ž ð™ ð™ ð™‘ ð™’ ð™“ ð™” ð™• ð™– ð™— ð™˜ ð™™ ð™š ð™› ð™œ ð™ ð™ž ð™Ÿ ð™  ð™¡ ð™¢ ð™£ ð™¤ ð™¥ ð™¦ ð™§ ð™¨ ð™© ð™ª ð™« ð™¬ ð™­ ð™® ð™¯ "                        .

                                     " ðž ðž‘ ðž’ ðž“ ðž” ðž• ðž– ðž— ðž˜ ðž™ ðžš ðž› ðžœ ðž ðžž ðžŸ ðž  ðž¡ ðž¢ ðž£ ðž¤ ðž¥ ðž¦ ðž§ ðž¨ ðž© ðžª ðž« ðž¬ ðž­ ðž® ðž¯ ðž° ðž± ðž² ðž³ ðž´ ðžµ ðž¶ ðž· ðž¸ ðž¹ ðžº ðž» ðž¼ ðž½ ðž¾ ðž¿ ðŸ€ ðŸ ðŸ‚ ðŸƒ ðŸ„ ðŸ… ðŸ† ðŸ‡ ðŸˆ ðŸ‰ " ],
       ["SCRIPT"                  => " ð’œ â„¬ ð’ž ð’Ÿ â„° â„± ð’¢ â„‹ â„ ð’¥ ð’¦ â„’ â„³ ð’© ð’ª ð’« ð’¬ â„› ð’® ð’¯ ð’° ð’± ð’² ð’³ ð’´ ð’µ ð’¶ ð’· ð’¸ ð’¹ ð‘’ ð’» â„Š ð’½ ð’¾ ð’¿ ð“€ ð“ ð“‚ ð“ƒ â„´ ð“… ð“† ð“‡ ð“ˆ ð“‰ ð“Š ð“‹ ð“Œ ð“ ð“Ž ð“ " ],
       ["ITALIC"                  => " ð´ ðµ ð¶ ð· ð¸ ð¹ ðº ð» ð¼ ð½ ð¾ ð¿ ð‘€ ð‘ ð‘‚ ð‘ƒ ð‘„ ð‘… ð‘† ð‘‡ ð‘ˆ ð‘‰ ð‘Š ð‘‹ ð‘Œ ð‘ ð‘Ž ð‘ ð‘ ð‘‘ ð‘’ ð‘“ ð‘” h ð‘– ð‘— ð‘˜ ð‘™ ð‘š ð‘› ð‘œ ð‘ ð‘ž ð‘Ÿ ð‘  ð‘¡ ð‘¢ ð‘£ ð‘¤ ð‘¥ ð‘¦ ð‘§ "                .
                                     " ð›¢ ð›£ ð›¤ ð›¥ ð›¦ ð›§ ð›¨ ð›© ð›ª ð›« ð›¬ ð›­ ð›® ð›¯ ð›° ð›± ð›² ð›³ ð›´ ð›µ ð›¶ ð›· ð›¸ ð›¹ ð›º ð›» ð›¼ ð›½ ð›¾ ð›¿ ðœ€ ðœ ðœ‚ ðœƒ ðœ„ ðœ… ðœ† ðœ‡ ðœˆ ðœ‰ ðœŠ ðœ‹ ðœŒ ðœ ðœŽ ðœ ðœ ðœ‘ ðœ’ ðœ“ ðœ” ðœ• ðœ– ðœ— ðœ˜ ðœ™ ðœš ðœ› " ],
       ["BOLD"                    => " ð€ ð ð‚ ðƒ ð„ ð… ð† ð‡ ðˆ ð‰ ðŠ ð‹ ðŒ ð ðŽ ð ð ð‘ ð’ ð“ ð” ð• ð– ð— ð˜ ð™ ðš ð› ðœ ð ðž ðŸ ð  ð¡ ð¢ ð£ ð¤ ð¥ ð¦ ð§ ð¨ ð© ðª ð« ð¬ ð­ ð® ð¯ ð° ð± ð² ð³ ðŸŽ ðŸ ðŸ ðŸ‘ ðŸ’ ðŸ“ ðŸ” ðŸ• ðŸ– ðŸ— " .
                                     " ðš¨ ðš© ðšª ðš« ðš¬ ðš­ ðš® ðš¯ ðš° ðš± ðš² ðš³ ðš´ ðšµ ðš¶ ðš· ðš¸ ðš¹ ðšº ðš» ðš¼ ðš½ ðš¾ ðš¿ ð›€ ð› ð›‚ ð›ƒ ð›„ ð›… ð›† ð›‡ ð›ˆ ð›‰ ð›Š ð›‹ ð›Œ ð› ð›Ž ð› ð› ð›‘ ð›’ ð›“ ð›” ð›• ð›– ð›— ð›˜ ð›™ ð›š ð›› ð›œ ð› ð›ž ð›Ÿ ð›  ð›¡ ðŸŽ ðŸ ðŸ ðŸ‘ ðŸ’ ðŸ“ ðŸ” ðŸ• ðŸ– ðŸ— " ],
       ["BOLD ITALIC"             => " ð‘¨ ð‘© ð‘ª ð‘« ð‘¬ ð‘­ ð‘® ð‘¯ ð‘° ð‘± ð‘² ð‘³ ð‘´ ð‘µ ð‘¶ ð‘· ð‘¸ ð‘¹ ð‘º ð‘» ð‘¼ ð‘½ ð‘¾ ð‘¿ ð’€ ð’ ð’‚ ð’ƒ ð’„ ð’… ð’† ð’‡ ð’ˆ ð’‰ ð’Š ð’‹ ð’Œ ð’ ð’Ž ð’ ð’ ð’‘ ð’’ ð’“ ð’” ð’• ð’– ð’— ð’˜ ð’™ ð’š ð’› "                .
                                     " ðœœ ðœ ðœž ðœŸ ðœ  ðœ¡ ðœ¢ ðœ£ ðœ¤ ðœ¥ ðœ¦ ðœ§ ðœ¨ ðœ© ðœª ðœ« ðœ¬ ðœ­ ðœ® ðœ¯ ðœ° ðœ± ðœ² ðœ³ ðœ´ ðœµ ðœ¶ ðœ· ðœ¸ ðœ¹ ðœº ðœ» ðœ¼ ðœ½ ðœ¾ ðœ¿ ð€ ð ð‚ ðƒ ð„ ð… ð† ð‡ ðˆ ð‰ ðŠ ð‹ ðŒ ð ðŽ ð ð ð‘ ð’ ð“ ð” ð• " ],

       ["FRAKTUR"                 => " ð”„ ð”… â„­ ð”‡ ð”ˆ ð”‰ ð”Š â„Œ ð” â„‘ ð”Ž K ð” ð” ð”‘ ð”’ ð”“ ð”” â„œ ð”– ð”— ð”˜ ð”™ ð”š ð”› ð”œ â„¨ ð”ž ð”Ÿ ð”  ð”¡ ð”¢ ð”£ ð”¤ ð”¥ ð”¦ ð”§ ð”¨ ð”© ð”ª ð”« ð”¬ ð”­ ð”® ð”¯ ð”° ð”± ð”² ð”³ ð”´ ð”µ ð”¶ ð”· " ],
       ["BOLD FRAKTUR"            => " ð•¬ ð•­ ð•® ð•¯ ð•° ð•± ð•² ð•³ ð•´ ð•µ ð•¶ ð•· ð•¸ ð•¹ ð•º ð•» ð•¼ ð•½ ð•¾ ð•¿ ð–€ ð– ð–‚ ð–ƒ ð–„ ð–… ð–† ð–‡ ð–ˆ ð–‰ ð–Š ð–‹ ð–Œ ð– ð–Ž ð– ð– ð–‘ ð–’ ð–“ ð–” ð–• ð–– ð–— ð–˜ ð–™ ð–š ð–› ð–œ ð– ð–ž ð–Ÿ " ],

    ];

    for my $fp (@$fontpairs) {
        my($name, $new) = @$fp;
        $name =~ s/(\w+)/\u\L$1/g;
        $new =~ s/\p{White Space}//g;
        my $old = NFKD($new);
        local $_ = $orig;
        eval "tr/$old/$new/";
        die if $@;
        #s/ /\N{NO-BREAK SPACE}\N{NO-BREAK SPACE}/g;
        s/ /\N{NO-BREAK SPACE}/g;
        s/\p{Upper}\K/\N{NARROW NO-BREAK SPACE}/g if $name ~~ [ qr/fraktur/i, qr/script/i ];
        printf "%26s %s\n", "$name:", $_  unless $orig eq $_;
    } 

}

sub init {
    if (grep /\P{ASCII}/ => @ARGV) { 
       @ARGV = map { decode("UTF-8", $_) } @ARGV;
    }
    $0 = basename($0);  # shorter messages
    $| = 1;
    for my $lexical_filehandle ( \(*STDIN,*STDOUT,*STDERR,*DATA) ) { 
        binmode($lexical_filehandle, ":utf8");
    }
}

sub expand()  {
    s/ /\xA0\xA0/g;
    s/\S\K/ /g;
}

__END__

